<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="renderer" content="webkit">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<title></title>
	<link rel="stylesheet" href="__PUBLIC__/common/frame/layui/css/layui.css">
</head>
<body class="body">

<blockquote class="layui-elem-quote">
	<legend class="">区域管理 </legend>
</blockquote>
<form class="layui-form" action="">
	<div class="demoTable">
		区域名称：
		<div class="layui-inline">
			<input class="layui-input" name="name" id="demoReload" autocomplete="off">
		</div>
		<!--
		区域名称：
		<div class="layui-inline">

			<select name="quiz"  lay-verify="required" lay-search="">
				<option value="">直接选择或搜索选择</option>

					<option value="1002">1002</option>
					<option value="1003">1003</option>
					<option value="1004">1004</option>

					<option value="2001">2001</option>
					<option value="2002">2002</option>

			</select>
		</div>
		-->
		<button class="layui-btn" lay-submit="" lay-filter="add">添加</button>
	</div>
</form>
<!-- table -->
<table class="layui-hide" id="LAY_table_user" lay-filter="user01"></table>


<script type="text/javascript" src="__PUBLIC__/common/frame/layui/layui.js"></script>
<script type="text/html" id="barDemo">
	<a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
</script>
<script>
    layui.use('table', function(){
        var table = layui.table;
        var form = layui.form
         ,layer = layui.layer
         ,layedit = layui.layedit
        //方法级渲染
        table.render({
            elem: '#LAY_table_user'
            ,url: 'http://portal.cn/index.php/Home/Area/lists'
			//,url: '/Public/home/datas/ad.json'
            ,id: 'testReload'
            ,page: true
            // ,height: 600
            ,height: 'full-200'
            ,cellMinWidth: 80
            ,limit:20
            ,limits:[20]
            ,cols: [[
                {checkbox: true, fixed: true}
                ,{field:'id', edit: 'text',title: 'ID',align:'center', width:'6%', sort: true, fixed: true}
                ,{field:'name',edit: 'text', title: '区域名称',align:'center',  width:'20%', fixed: true}
                ,{field:'parent_id', edit: 'text',title: '维护时间',align:'center',  width:'20%', fixed: true}
                ,{fixed: 'right', title: '操作',align:'center',  width:280, fixed: 'right' , toolbar: '#barDemo'}
            ]]

        });
        console.log(table);
        /*数据操作  开始*/
        var table = layui.table;
        //监听表格复选框选择
        table.on('checkbox(user01)', function(obj){
            console.log(obj)
        });
        //监听单元格编辑
        table.on('edit(user01)', function(obj){
            var value = obj.value //得到修改后的值
                ,data = obj.data //得到所在行所有键值
                ,field = obj.field; //得到字段
            layer.msg('[ID: '+ data.id +'] ' + field + ' 字段更改为：'+ value);
        });
        //监听工具条
        table.on('tool(user01)', function(obj){
            var data = obj.data;
            if(obj.event === 'detail'){
                layer.prompt({
                    formType: 2
                    ,title: '修改 ID 为 ['+ data.id +'] 的用户签名'
                    ,value: data.sign
                }, function(value, index) {
                    layer.close(index);

                    //这里一般是发送修改的Ajax请求

                    //同步更新表格和缓存对应的值
                    obj.update({
                        sign: value
                    });
                });
                layer.msg('ID：'+ data.id + ' 添加操作');
            } else if(obj.event === 'del'){
                layer.confirm('真的删除行么', function(index){
                    obj.del();
                    layer.close(index);
                });
            } else if(obj.event === 'edit'){
                layer.alert('编辑行：<br>'+ JSON.stringify(data))
            }
        });

        var $ = layui.$, active = {
            getCheckData: function(){ //获取选中数据
                var checkStatus = table.checkStatus('testReload')
                    ,data = checkStatus.data;
                layer.alert(JSON.stringify(data));
            }
            ,getCheckLength: function(){ //获取选中数目
                var checkStatus = table.checkStatus('testReload')
                    ,data = checkStatus.data;
                layer.msg('选中了：'+ data.length + ' 个');
            }
            ,isAll: function(){ //验证是否全选
                var checkStatus = table.checkStatus('testReload');
                layer.msg(checkStatus.isAll ? '全选': '未全选')
            }

            /*数据查找 开始*/
            ,reload: function(){
                var demoReload = $('#demoReload01');

                //执行重载
                table.reload('testReload', {
                    page: {
                        curr: 1 //重新从第 1 页开始
                    }
                    ,where: {
                        key: {
                            id: demoReload.val()
                        }
                    }
                });
            }
        };

        $('.demoTableFind .layui-btn').on('click', function(){
            var type = $(this).data('type');
            active[type] ? active[type].call(this) : '';
        });
        /*数据查找 结束*/
        $('.demoTable .layui-btn').on('click', function(){
            var type = $(this).data('type');
            active[type] ? active[type].call(this) : '';
        });


        /*数据操作  结束*/



// 删除公共方法   deleteAll(ids,请求url,操作成功跳转url,操作失败跳转url)
        function deleteAll(ids,url,sUrl,eUrl){
            // ids不能为空
            if(ids == null || ids == ''){
                layer.msg('请选择要删除的数据',{time:2000});
                return false;
            }else{
                layer.confirm('确认删除选中数据?', {
                    title: '删除',
                    btn: ['确认', '取消'] // 可以无限个按钮
                }, function(index, layero){
                    // 确认
                    $.post(url,{ids:ids},function(res){
                        // 大于0表示删除成功
                        if(res.status > 0){
                            // 提示信息并跳转
                            layer.msg(res.msg,{time:2000},function(){
                                location.href = sUrl;
                            })
                        }else{
                            // 提示信息并跳转
                            layer.msg(res.msg,{time:2000},function(){
                                location.href = eUrl;
                            })
                        }
                    });
                }, function(index){
                    // 关闭
                    layer.close(index);
                });
            }
        }
//自定义验证规则
        form.verify({
            title: function (value) {
                if (value.length < 5) {
                    return '标题至少得5个字符啊';
                }
            }
        });
        //监听提交
        form.on('submit(add)', function(data){
            layer.alert(JSON.stringify(data.field), {
                title: '最终的提交信息'
            })
            var data = (JSON.stringify(data.field));
            $.ajax({
                type: "post",
                url: "http://portal.cn/index.php/Home/Area/add",
                data: data,
                dataType: "text",
                success: function(data){
                    return false;
                }
            });
            return false;
        });
    });
</script>
</body>
</html>